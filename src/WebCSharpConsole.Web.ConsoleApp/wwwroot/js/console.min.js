require(["vs/editor/editor.main"],function(){function n(n){var i=this,r=$(n),u=r.find(`.${t}`),f=u[0],e=r.find(".console-output"),o=e[0];i._consoleOutputEditor=i._initConsoleOutput(o);i._consoleEditor=i._initConsoleEditor(f);i._consoleEditorAddActions();i._consoleEditorAddOnDidChangeModelContent();i._$runButton=r.find(".run-button");i._$runButton.on("click",function(){i._compileAbdRun()})}var t="console-code";n.prototype=Object.create({});n.prototype.constructor=n;n.prototype._initConsoleEditor=function(n){return monaco.editor.create(n,{value:"using System;\nusing System.Collections.Generic;\nusing System.Linq;\n\npublic class Program\n{\n   public static void Main()\n   {\n   }\n}",language:"csharp",automaticLayout:!0,lineNumbers:!0,roundedSelection:!0,scrollBeyondLastLine:!1,readOnly:!1,theme:"vs-dark",wordWrap:"on",wordWrapMinified:!0,wrappingIndent:"indent"})};n.prototype._initConsoleOutput=function(n){return monaco.editor.create(n,{value:"Console output",language:"text",automaticLayout:!0,lineNumbers:!0,roundedSelection:!0,scrollBeyondLastLine:!1,readOnly:!1,theme:"vs-dark",wordWrap:"on",wordWrapMinified:!0,wrappingIndent:"indent"})};n.prototype._consoleEditorAddActions=function(){var n=this;n._consoleEditor.addAction({id:"compile-and-run-id",label:"Run",keybindings:[monaco.KeyMod.CtrlCmd|monaco.KeyCode.F5],precondition:null,keybindingContext:null,contextMenuGroupId:"navigation",contextMenuOrder:.5,run:function(){n._compileAbdRun()}})};n.prototype._consoleEditorAddOnDidChangeModelContent=function(){var n=this,t=[],i=null;n._consoleEditor.onDidChangeModelContent(function(){clearTimeout(i);i=setTimeout(function(){var i=n._consoleEditor.getValue();$.ajax({method:"POST",url:"/home/TestCompile",data:{code:i}}).done(function(i){if(i.success){t=n._consoleEditor.deltaDecorations(t,[]);return}var r=i.diagnostics.map(function(t){return{range:new monaco.Range(t.range.startLineNumber,t.range.startColumnNumber,t.range.endLineNumber,t.range.endColumnNumber),options:{inlineClassName:n._getDecorationClassByDiagnostic(t),hoverMessage:t.message}}});t=n._consoleEditor.deltaDecorations(t,r)})},2e3)})};n.prototype._getDecorationClassByDiagnostic=function(n){switch(n.diagnosticKind){case 1:return"code-info";case 2:return"code-warning";case 3:return"code-error";default:return""}};n.prototype._compileAbdRun=function(){var n=this,t=n._consoleEditor.getValue();n._$runButton.off();n._$runButton.button("loading");$.ajax({method:"POST",url:"/home/CompileAndRun",data:{code:t}}).done(function(t){var i;t.success?i=`${t.consoleOutput}
Execution time: ${t.executionTimeMs} ms`:t.compilationFailed?i=`Build failed: 
 Error List: 
 ${t.compilationErrors}`:t.isTimeouted?i=`Execution timeout, max execution time is: ${t.maxExecutionTimeMs} ms`:t.isExceptionThrown&&(i=`Exception message: 
 ${t.exceptionMessage}
Stack Trace: 
${t.exceptionStackTrace}`);n._consoleOutputEditor.setValue(i);n._consoleOutputEditor.setScrollTop(n._consoleOutputEditor.getScrollHeight());n._$runButton.button("reset");n._$runButton.on("click",function(){n._compileAbdRun()})})};monaco.languages.registerCompletionItemProvider("csharp",{provideCompletionItems:function(n,t){var i=n.getValue(),r=n.getValueLengthInRange(new monaco.Range(0,0,t.lineNumber,t.column));return new Promise(function(n){$.ajax({method:"POST",url:"/home/GetRecommendations",data:{code:i,index:r}}).done(function(t){n(t)})})}});$(document).ready(function(){var t=document.getElementById("console-wrapper"),i=new n(t)})});